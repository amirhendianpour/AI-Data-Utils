# تشخیص اشیاء با OpenCV و YOLO

[🇬🇧 English](README.md) | [🇮🇷 فارسی](README.fa.md)

اسکریپت پایتون ارائه شده از OpenCV برای تشخیص اشیا در تصاویر و ذخیره مختصات آنها در قالبی که به طور معمول توسط الگوریتم تشخیص شی YOLO استفاده می شود، بهره می برد.

## شرح

این اسکریپت برای شناسایی اشیا در یک تصویر ورودی طراحی شده و سپس مختصات کادر محدود کننده آنها را برای پردازش بیشتر یا آموزش مدل استخراج می کند. در اینجا تفکیک عملکرد آن آمده است:

1.  **وارد کردن کتابخانه ها:** اسکریپت ابتدا کتابخانه های ضروری OpenCV (`cv2`) و PIL را برای عملیات تصویر وارد می کند.

2.  **خواندن تصویر:** تصویر ورودی از طریق متغیر `image_path` مشخص شده و با استفاده از `cv2.imread()` خوانده می شود.

3.  **پیش پردازش:**

    * تصویر رنگی به مقیاس خاکستری تبدیل می شود تا پیچیدگی تشخیص لبه کاهش یابد.

    * برای به دست آوردن لبه های واضح برای تشخیص حاشیه، یک آستانه باینری معکوس بر تصویر مقیاس خاکستری اعمال می شود.

4.  **تشخیص حاشیه:** تابع `cv2.findContours()` برای استخراج حاشیه اشیا در تصویر آستانه دار استفاده می شود. این حاشیه ها نشان دهنده مرزهای اشیا هستند.

5.  **فیلتر کردن و رسم کادر محدود کننده:**

    * اسکریپت در میان حاشیه های به دست آمده تکرار می شود.

    * حاشیه های کوچک تر از 100x100 پیکسل و حاشیه های بزرگ تر (640x640) برای حذف نویز یا اشیای نامربوط نادیده گرفته می شوند.

    * برای هر حاشیه باقی مانده، اسکریپت یک کادر محدود کننده مستطیلی را با استفاده از `cv2.boundingRect()` محاسبه می کند.

    * سپس، این کادر محدود کننده بر روی تصویر اصلی با یک مستطیل سبز رنگ با ضخامت 2 پیکسل ترسیم می شود.

6.  **نمایش نتایج:** تصویر اصلاح شده با کادرهای محدود کننده با استفاده از `cv2.imshow()` در یک پنجره نمایش داده می شود. اسکریپت تا زمانی که کاربر کلیدی را فشار ندهد (`cv2.waitKey(0)`) منتظر می ماند و سپس تمام پنجره های باز را می بندد (`cv2.destroyAllWindows()`).

7.  **ذخیره مختصات:**

    * در نهایت، اسکریپت مختصات کادرهای محدود کننده را در یک فایل متنی به نام `coordinates.txt` ذخیره می کند.

    * هر خط در فایل نشان دهنده یک شی شناسایی شده است و مختصات آن (x، y، عرض، ارتفاع) را با کاما از هم جدا می کند. این قالب برای استفاده با الگوریتم هایی مانند YOLO که نیاز به مختصات کادر محدود کننده برای آموزش یا پیش بینی تشخیص شی دارند، مناسب است.

## الزامات

* پایتون 3.x

* OpenCV (`cv2`)

* PIL (Pillow)

## نحوه استفاده

1.  اطمینان حاصل کنید که پایتون 3.x نصب شده است.

2.  OpenCV و PIL را از طریق pip نصب کنید:

    `pip install opencv-python`

    `pip install Pillow`

3.  اسکریپت پایتون را اجرا کنید.

## ورودی

* اسکریپت یک تصویر ورودی را می گیرد که مسیر آن توسط متغیر `image_path` مشخص شده است. به طور پیش فرض، روی '3.jpg' تنظیم شده است.

## خروجی

این اسکریپت دو نوع خروجی تولید می کند:

1.  **نمایش بصری:** پنجره ای نمایش داده می شود که تصویر اصلی با کادرهای محدود کننده سبز رنگ در اطراف اشیای شناسایی شده را نشان می دهد.

2.  **فایل متنی:** یک فایل متنی به نام `coordinates.txt` در همان دایرکتوری اسکریپت ایجاد می شود. این فایل حاوی مختصات کادرهای محدود کننده شناسایی شده است که هر شی در یک خط با فرمت "x، y، عرض، ارتفاع" قرار دارد.

## پارامترها

* `image_path`: مسیر تصویر ورودی.

* `cv2.threshold(gray_image, 128, 255, cv2.THRESH_BINARY_INV)`: مقدار آستانه (128) ممکن است نیاز به تنظیم داشته باشد.

* `if w - x > 100 and h - y > 100:`: حداقل اندازه کادر محدود کننده.

* `if w - x == 640 and h - y == 640:`: حداکثر اندازه کادر محدود کننده.

* `cv2.rectangle(output_image, (x, y), (x + w, y + h), (0, 255, 0), 2)`: رنگ و ضخامت مستطیل.

* `with open('coordinates.txt', 'w') as file:`: نام فایل خروجی.
